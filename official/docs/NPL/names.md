## 变量与名字


```@BigFile
styleID: 0
bigFile:
  src: >-
    https://api.keepwork.com/storage/v0/siteFiles/356/raw#NPL CAD教学3.4.mp4
  ext: mp4
  filename: NPL CAD教学3.4.mp4
  size: 38162422
```
[在腾讯视频播放](https://v.qq.com/x/page/r0364ayz4tj.html)



在`2.2节程序的本质`中，我们已经使用过变量。这一节我们来更深入的学习变量与名字。程序中的变量英文是Variable，与我们数学课上所说的函数变量不是一个意思。

> 程序中的变量只是某个存储单元的名字，它会直接输出程序执行的瞬间它所代表的存储单元。

```lua
a = 3 + 4
log(a)
```
上面的代码，我们运行一下，可以看到输出是7。在这里a是一个变量，它所代表的存储单元的数据是7。变量只是高级计算机语言中的一种重要手段，方便在代码中快速的连接输入和输出。实际上计算机执行的底层硬件（CPU）指令是不存在变量的，在硬件中只有存储单元的数字地址，所以变量的名字我们可以随意起。程序员喜欢用一些很长的易于理解的单词或单词组合作为名字。例如下面这个例子：
```lua
char_size = 200
scaleTo(char_size)
```
`char_size`等于200，scaleTo放大到char_size。我们运行一下，可以看到人物放大到了200%，在这里`char_size`是一个变量，我们从名字中就可以看出，它代表了人物的大小（character size）。同样的代码，我们也可以这样写:
```lua
s = 200
scaleTo(s)
```
很明显，使用char_size作为名字比使用s好得多。因为长名字更清楚明了，易于理解。

在NPL语言中，同一个变量可以在程序运行的不同时刻指向任何类型的存储单元。例如：
```lua
a = 1
a = "hello"
log(a)
```
我们把前面的代码删除，输入上面的代码并重新运行一下。`log(a)`输出的结果为hello，而不是1。变量在同一时刻只能代表一个存储单元。a等于hello执行后，变量a已经不再指向1，而是指向字符串hello所在的存储单元。所以`log(a)`输出的是当时a所指向的存储单元，也就是hello。

> 变量是有生命周期的，变量的生命周期在程序中叫做作用域(Scope)。

在NPL语言中，变量的作用域是我们可以使用这个变量名的代码区间。在NPL语言中有两种方式定义变量的作用域，一种是本地的变量（local），一种是全局的变量(默认的)。我们来看一个例子：
```lua
a = 1
local b
b = a + 2
b = b + 3
log(b)
```
每个代码方块其实是一个独立的文件。在NPL语言中，如果我们在文件中直接使用一个变量，例如上面的a等于1，则变量a的作用域默认是全局的。全局变量可以在所在文件的任意位置使用, 默认情况下也可以在其他文件中使用。关于如何将程序拆分为多个文件，我会在`2.7节`函数中讲解。这里大家简单理解为，文件就是函数，也有输入和输出，可以相互连接。

我们继续看第二行`local b`它定义了一个`本地变量`。这里`local`是一个系统内置的特殊名字，表示用它后面输入的变量名字重新定义一个新的本地变量。b的作用域是从local开始，直到所在文件或函数的结束。

变量b无法在local之前的代码中使用，也无法在其它文件中使用。所以一般来说，本地变量的生命周期是从local开始到文件或函数执行结束。

这里大家首先要明白，变量只是存储单元的一个名字，因此变量的生命周期和它所代表的存储单元的生命周期没有关系。一个变量在程序运行的过程中可以代表不同的存储单元，就像例子中这样；同样一个存储单元也可以有多个不同的变量名字。例如：

```lua
a = "hello"
b = a
log(a)
log(b)
```
b和a指向的是同一个字符串存储单元即hello。注意有一些编程语言中，等号函数会复制一份新的相同内容的存储单元，但是NPL中，a和b是指向同一个存储单元的，所以`log (a)`和`log(b)`的输出都是hello。

在NPL中当一个存储单元没有任何变量指向它时，存储单元会被系统自动释放掉。所以很多时候变量和它所代表的存储单元的生命周期是几乎一样的。所以我们应该尽量多用局部变量，让变量的生命周期尽可能短一些，这样可以节约内存，代码也执行的更快。

> 写代码时，能用局部变量就绝不用全局变量

我们再回到最初的代码。

> `Ctrl+Z` 可以回滚我们刚刚敲入的代码。

这里我们在代码中加入一些log语句。
```lua
a = 1
local b
log(b)  -- nil
b = a + 2
log(b)  -- 3
b = b + 3
log(b)  -- 6
```
我们先看第一个`log(b)`。此时b没有指向任何存储单元，所以输出的结果为nil。 

> nil在NPL中是一个常量，代表一个无效的存储对象。

然后我们将a+2输出3赋给b, 此时第二个`log(b)`的输出结果为3，我们也可以合并一下，直接写成`local b = a + 2`。
```lua
a = 1
local b = a + 2
log(b)  -- 3
b = b + 3
log(b)  -- 6
```

同理下一行`b = b + 3`有加号和等号两个函数先后执行。b开始会输出3，3+3输出了6，等号函数又将6赋给了b所以最后一个`log(b)`输出了6。我们可以看到在程序运行过程中，本地变量b所代表的存储单元发生了变化。NPL中的存储单元也叫对象。

> 对象的类型只有7种，分别是数字，字符串，函数，表，true，false和nil。

变量可以给所有7种对象起名字，上面代码中的`log`实际上也是一个全局变量。当变量指向一个函数时，我们习惯性的将变量名说成是函数，所以log函数也是log变量。代码中的1, 2, 3是数字，hello是字符串， 等号和加号是数学函数。

在程序中没有加双引号的文字都是变量，更确切的说，代码中由文字和下划线组成的任意单词都是变量（只有少数几个例外, 比如local）。在NPL中变量区分大小写，因此小写a和大写A是两个不同的变量，和数学中的变量命名不同，程序员一般会给变量起一个很长的便于识别的名字，并习惯遵守一些人为的规则。例如`count, char_size, length, walkRadius`都是不错的变量名。NPL支持使用中文作为变量名，但是我们不建议大家这样做，一个原因是打字时你需要不停的切换输入法影响打字速度，最重要的原因是你很难用中文创造新的不存在的短词汇。 

下面我们来看变量在程序中的用途。我们用代码方块编一段代码:

```lua
say("hello! ".."xxx")
tip("hello! ".."xxx")
```

我们运行一下，可以看到人物说"hello! xxx"。这段代码其实是用say函数让角色说一句话, 再用tip函数在屏幕中央打印一行文字。
 
```@BigFile
bigFile:
  src: 'https://api.keepwork.com/storage/v0/siteFiles/2418/raw#image.png'
  ext: png
  filename: image.png
  size: '211654'
  unit: px
  width: 550
  alignment: left

```


`..`和`+`函数类似，是将左右2个字符串合并，并返回结果。关于`..`函数和字符串我们在`2.5节中`会详细讲解。这里`"hello! ".."xxx"`会返回一个新的字符串`"hello! xxx"`。

下面我们再用变量改写一下上面的代码：
```lua
-- name of the main player
local name = "xxx"

-- welcome the user
local text = "hello! "..name
say(text)
tip(text)
```
先定义一个本地变量name等于"hello"，我们在前面加上一行注释, 也就是角色的名字。
然后再定义一个本地变量text，将`"hello! "..name`的结果赋给它。 然后我们再分别调用say和tip函数。我们运行一下，结果是一样的。

加入变量name，代码变得更加容易理解和方便修改了，我们只需要看到注释和变量名，就基本理解了下面一段代码是做什么的，并且还可以直接修改变量的输入，来影响后面整段代码的输出。例如我们将name改成Alice，重新运行，可以看到2个地方都变成了"hello! Alice"。如下图:
 
```@BigFile
bigFile:
  src: 'https://api.keepwork.com/storage/v0/siteFiles/2419/raw#image.png'
  ext: png
  filename: image.png
  size: '216683'
  unit: px
  width: '550'
  alignment: left

```

变量是编程中最难理解的概念，程序员在编程时有一大半的时间都在思考代码中需要哪些变量，是本地的还是全局的，以及用什么通俗易懂的名字。后面我们还会看到函数名本身也是变量，所以变量无处不在。

> 变量也可以看成是计算机语言的词汇。写代码的过程其实就是在不断创造新的词汇, 并用这些词汇去描述我们要解决的问题。

代码的90%都是各种变量名。高级和初级程序员代码的主要区别就是在变量的使用和命名上。优秀的程序员能够创造大量简单易懂的词汇去描述和解决问题。初级程序员往往只用少量晦涩难懂的词汇解决问题。和用自然语言写文章一样， 我们要多读，多写才能写出优美的程序来。另外就是鼓励大家学好英语，因为世界上99.99%的程序的变量名都是英文的，所以只有学好英语才能读懂别人的代码，创造出良好的变量名。

---



> 思考1：什么是变量？计算机中的存储单元是什么？ 

内存，硬盘？ 

> 思考2： 一个物体可以有多个名字么？

> 思考3：我们教室中有几类物体？计算机中有几种类型的对象？

7种

> 思考4：变量的名字是随意的么？为什么是随意的？为什么要用长名字？

是；CPU并不理解名字，只有0101这样的地址，有的是32位的，有的是64位的，就像我们几排几列的座位一样。 所以名字并不重要，CPU只知道存储单元的地址。

> 思考5：练习用变量制作一个代码方块的作品，比如。 

```lua
local text = "hello"
say(text, 2)
say("3+4=？", 2)
local a = 3 + 4
say(a)
```



