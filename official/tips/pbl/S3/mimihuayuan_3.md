## 《秘密花园》第三节
 
提示：如视频播放不了，可在课程项目世界里，点击“讲解回放”进行观看。
 
<video width="100%" controls controlslist="nodownload nofullscreen noremoteplayback" disablePictureInPicture>
  <source src="https://api.keepwork.com/ts-storage/siteFiles/21812/raw#秘密花园L3.webm" type="video/webm" />
  <source src="https://api.keepwork.com/ts-storage/siteFiles/21811/raw#秘密花园L3.mp4" type="video/mp4" />
   
  你的浏览器不支持播放
</video>
<style>
video::-webkit-media-controls-fullscreen-button { display: none; } 
</style>


### 步骤一

前面两节课的学习，我们的迷宫程序已经基本完善了
为了让迷宫更加丰富，这节课我们给迷宫设计一些机关门吧
首先，需要一个机关门的bmax模型
这里，我们就地取材，选中3x2的迷宫墙
保存为bmax模型，命名为door
点击不可拖动，修改为可拖动
然后，找到一个合适的位置，把机关门放置于场景中
右键点击机关门，拖动小方块，调整机关门到合适大小
然后，点击属性，修改机关门为有真实物理
通过利用活动模型的点击事件，可以设计机关门的机关
这里，我们选择抬起或下落的点击效果
点击确定，点击机关门，可以看到机关门抬起了一小格距离
再次点击，机关门就回到了原来的位置
如果想要让机关门抬起更高，则需要修改点击事件的参数
我们将机关门抬起的高度修改为2
调整好参数后，我们来测试一下
点击机关门，可以看到机关门抬起的高度变成了两格
那如何设置机关门的打开效果为下落两格呢？
不难，只需要把刚才的参数修改为负2就可以了
右键点击机关门，我们再修改下参数
修改好后，再来测试下
点击机关门，可以看到机关门打开的方式为下落啦
到这里，一个简单的迷宫机关门就设置完成了

### 步骤二

上一小节，我们设计了一个向下打开的机关门
那还有没有以其他方式打开的机关门呢？
答案是肯定的，下面我们来制作一个旋转打开的机关门
点击E按钮，打开工具栏，在工具子标签下选择活动模型
然后点击模型，选择前面制作好的机关门Bmax模型
右键放置在场景中
同样地，先调整机关门为合适大小，以及修改为有真实物理
然后在点击事件中，选择开/关门的点击效果
它默认的参数是围绕着y轴旋转90度打开
点击确定，设置好后我们点击机关门进行测试
可以看到，一个旋转打开的机关门就制作完成啦
其他的效果你可以自己去试试哦


### 步骤三

经过前面的学习，我们的迷宫已经比较完善了
我们先点击拉杆，启动迷宫游戏来看看效果吧
控制主角进入迷宫
按下F键还可以进入飞行模式，按空格键也可以跳跃
这时，主角可以直接飞起来越墙过去通关了
为了增加游戏体验，我们应该阻止这种行为
那么，应该如何阻止呢？
我们可以使用命令设置迷宫规则，禁止主角飞行和跳跃
右键打开代码方块，在事件标签下拖出【执行命令】指令
选择添加规则：人物可跳跃
然后在数据标签下，拖出布尔值指令“真”，放到右边圆框中
再将“真”修改为“假”，这样设置规则不让主角跳跃
类似的操作，我们再禁止主角飞行
点击运行，看看是否能得到想要的效果
发现此时按下空格键，主角还是可以跳起来
规则似乎没生效，这是为什么呢？
这是因为当前世界属于编辑模式，在这个模式下规则不生效
所以，需要在设置这些规则前，让世界进入游戏模式
切换世界模式的指令在感知标签下
将它拖入代码编辑区，设置世界为游戏模式
然后再点击运行，按下空格键，发现主角不会再跳跃了
按下F键，主角也被禁止飞行了
这说明在游戏模式下，迷宫规则生效了
那如何把世界模式切换回编辑模式呢？
我们可以按下Ctrl键和G键，这个组合键可以让世界在两种模式之间切换
再次启动拉杆，运行程序，进入游戏模式
此时再按下Ctrl键和G键，切换回编辑模式
在编辑模式下，如果再按一下这个组合键，可以再次进入游戏模式
到这里，迷宫规则就设置好了


### 步骤四

迷宫规则添加好了，现在，启动迷宫游戏后
拖拽鼠标右键可以不停转换视角，这样的游戏体验也是不够好的
这一小节，我们来编程控制摄影机，固定迷宫的视角
首先，同时按下Ctrl键和G键切换到编辑模式
然后，右键打开控制主角的代码方块
将外观标签下的【控制摄影机】指令拖过来
点击运行，可以看到，摄影机朝向90度时，视角看向了主角面向的左侧
我们试试将朝向的90修改为负90，再点击运行看看
可以看到，此时视角与90度时恰好相反
为了更加清楚度数与视角之间的关系，我们再试试朝向0度和180度的视角
修改参数为0度，点击运行，看看效果
再修改参数为180度，点击运行，看看效果
经过调试，可以得出朝向180度就是我们要找的度数
但是，值得注意的是，我们还需要把这条指令放到【永远重复】指令里面
这样，才能一直固定住这个视角
到这里，一个相对完整的迷宫就完成啦
但迷宫还有没有可优化的地方呢？
比如更复杂的机关组合门、有趣的迷宫NPC？
这些我们在下节课可以学习到哦