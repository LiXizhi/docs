## 《音乐之声》第三节
 
提示：如视频播放不了，可在课程项目世界里，点击“讲解回放”进行观看。
 
<video width="100%" controls controlslist="nodownload nofullscreen noremoteplayback" disablePictureInPicture>
  <source src="https://api.keepwork.com/ts-storage/siteFiles/21843/raw#音乐之声L3.webm" type="video/webm" />
  <source src="https://api.keepwork.com/ts-storage/siteFiles/21844/raw#音乐之声L3.mp4" type="video/mp4" />
   
  你的浏览器不支持播放
</video>
<style>
video::-webkit-media-controls-fullscreen-button { display: none; } 
</style>

### 步骤一

经过前面两节课的学习，我们实现了点击琴键播放音符的效果
不过，在点击的过程中琴键没有任何反应，显得弹奏有点呆板
如果琴键有被按下回弹的效果那就更好了
这一小节，我们就来实现这个效果
打开控制琴键声音的代码方块
想要让琴键点击的时候有被按下的效果
我们需要修改y轴坐标的值，让琴键往下位移一段距离
将运动项下的【位移】指令拖过来，修改y轴坐标参数为-1
x轴坐标参数为0，z轴参数不变
点击运行，点击琴键，可以看到琴键被按下了
往下位移太多，直接掉下去了，我们再来调整下参数到合适值
按下的效果实现了，我们接着实现回弹的效果
终止程序运行，再添加一条【位移】指令
要回弹，则需要让琴键往y轴的正方向移动
所以，这里我们修改【位移】指令y轴参数为0.2
x轴坐标参数为0，z轴坐标参数不变
再次点击运行，点击琴键，可以看到琴键按下之后自动回弹了
不过，这个速度好像稍微有点慢
我们再来修改一下【位移】指令的时间参数，让它移动的更顺畅
点击运行，再看看效果
关闭代码方块，到这里，关于如何让琴键按下回弹的效果就成功实现了

### 步骤二

上一小节，我们实现了琴键按下回弹的效果
点击琴键播放声音的效果好像不太符合电子琴弹奏的习惯
这一小节，我们实现如何通过键盘上的按键去控制琴键
打开代码方块，我们把【当演员被点击时】指令删除
将事件项下的【当空格键被按下时】指令拖过来
【当空格键被按下时】指令在按下指定按键后会执行里面的程序
点击空格键，可以切换对应的按键，这里我们切换成1键
当按下1时，播放音符1
点击运行，我们可以看到，当按下1键时，所有的按键都有被按下的效果
这是因为这个代码方块控制的是所有的琴键角色
所以这里我们需要添加一个条件判断来限制
我们来添加程序，将【如果那么】指令拖过来，设置条件
将运算项下的【0=0】指令拖过来
只有角色属性等于1的时候，我们才播放音符1的声音并且让按键1有按下回弹的效果
添加好程序后，我们再次点击运行
按下1键，可以看到只有琴键1有被按下的效果了
接着，我们复制这一整段代码
修改【当1键被按下时】指令参数为2，判断条件的参数也修改为2
点击运行，按下2键，播放音符2
这样，琴键2的效果也做好了
同样的方法，我们可以给其他琴键也添加同样的效果
你快去试试吧！


### 步骤三

这一小节，我们来了解一下简谱的编码
简谱，也叫做数字简谱，是指通过1234567这7个数字代表7个基本音符
对音符进行一定的排列组合，就可以得到一首好听的曲子
场景中有三个代码方块，第一个代码方块用来控制琴键生成
这里，我们使用的是克隆的方法生成琴键，跟第二节课学习的方法一样
第二个代码方块用来播放音符声音
打开代码方块，点击放大代码编辑区，来看看代码
跟前面学习的方法不一样的地方，就是我们这里的条件判断是跟这个变量进行比较
而这个变量的值是通过【广播消息】指令传递过来的
关于参数的传递我们在后面的课程中会给大家详细介绍到
最后一个代码方块就是用来控制简谱编码，打开代码方块
我们可以看到在第一行，有一条【全局变量赋值为】指令
这条指令后面的参数就是我们说的简谱编码了，每一个数字代表对应的音符
然后，通过【循环变量】指令，遍历每一个字符，并把这个字符赋值给一个变量
最后，【广播消息】指令再将这个音符参数传递过去
这样，当收到广播消息时就可以获取这个音符参数并将音符播放出来
通过这个方法，我们就可以实现对喜欢的曲子进行编码，并播放出来了
只需要修改一下这里的值就可以了哦
关闭代码方块，开启拉杆，我们来听一下这首曲子吧
你听出来这是哪首曲子了吗？你也来试试吧

