

## 第103天：代码方块教学2


```@TencentVideo
styleID: 0
tencentVideo:
  vid: 'h3351kgwnfv'

```


## 讲解

**1 理论**

讲授知识点：
- 两个或多个代码方块放在一起
- 多个代码方块的同时运行
- 给相邻的代码方块命名
- 用拉杆连接不同的代码方块，同时控制多个角色形成一个大的系统
  - 临时断开拉杆对某代码方块进行“单元测试”
- turn，say，play，moveForward，registerClickEvent函数
- while控制语句

**2 实践：**
上一节是一个代码方块。这一节我们来讲两个代码方块的例子。那么首先右键创建一个新的代码方块，右键编辑它，这时仍然在旁边自动创建了一个电影方块。右键单击电影方块，演员已经自动添加好了。我们给它做一段动画，时长改为3秒，我们做一个招手的动作，第0秒时让他的手臂举起来，500毫秒时让手臂降下来，敬个礼。 1000毫秒时再恢复举手的动作。我们关闭电影方块，演员就消失了。

 
```@BigFile
bigFile:
  src: 'https://api.keepwork.com/storage/v0/siteFiles/2749/raw#image.png'
  ext: png
  filename: image.png
  size: '733092'
  unit: px
  width: 550
  alignment: left

```

这时我们先点击运行，在没有写代码的情况下，演员也会出现。此时演员是背对我们的。我们现在到运动项下，将`旋转到turnTo`拖过来，我们改成`turnTo(180)`度，点一下运行，演员就转过来了。

> 我们尽量每写一行代码就点一下运行，这样如果有错误的话，我们很好调试。

下面我们让他说一句话，在外观项下将`说hello`拖过来，我们让他说一句中文，`点击我`。
 
```@BigFile
bigFile:
  src: 'https://api.keepwork.com/storage/v0/siteFiles/2750/raw#image.png'
  ext: png
  filename: image.png
  size: '17968'
  unit: px
  width: '400'
  alignment: left

```

点击代码窗口左上角的`En`(English)按钮可切换到系统输入法，并输入中文， 大家记得输完中文后一定要再次点击切回英文的输入法，因为中文的标点符号计算机语言无法识别，一定要使用英文的输入法，这点很重要。 

然后我们仍然马上运行一下，可以看到演员在180度的位置说`点击我`，然后我们到事件项下，将`当演员被点击时`这条代码拖过来，我们再到运动向下，将`旋转15度拖`过来，为了好看，我们敲Tab键，让代码缩进一格。这时我们运行一下，输出框没有报错，我们点击一下演员，他就转了15度，我们再点它就再转15度。
 
```@BigFile
bigFile:
  src: 'https://api.keepwork.com/storage/v0/siteFiles/2751/raw#image.png'
  ext: png
  filename: image.png
  size: '421860'
  unit: px
  width: 550
  alignment: left

```


我们如何让演员不停地旋转呢？我们来到控制项下，找到`永远重复`(while true do end)。我们将它拖过来，同样为了好看，我们将它缩进。 

我们把turn(15)度剪切一下，粘贴到while true do end的中间。同样前面也缩进了一格。

```lua
turnTo(180)
say("点击我!")

registerClickEvent(function()
    while(true) do
        turn(15)   -- 改为turn(1)可以变慢
    end
end)
```
这里while是循环的意思，true是真。while(true)就是不停的循环，它会不停的执行do和end之间的代码，也就是不停地执行turn(15)度。那么效果是演员不停的旋转。我们点击运行，点击一下演员，可以看到演员在不停的旋转，它现在旋转的太快了，我们让它每一次只旋转1度。再运行一下，点击演员，可以看到它现在是缓慢地旋转了。

我们点击暂停。现在我们来添加第二个代码方块，我们在它旁边再添加一个。 

 
```@BigFile
bigFile:
  src: 'https://api.keepwork.com/storage/v0/siteFiles/2752/raw#image.png'
  ext: png
  filename: image.png
  size: '648582'
  unit: px
  width: 550
  alignment: left

```

那么在新的代码方块中，我们仍然让演员去响应点击事件。这一次当演员被点击时，我们让它不停地往前走，我们同样还是使用`永远重复`，右键点击`永远重复`让提示窗口一直显示在代码区的上方。我们照着上面的例子敲一下代码，这次我们不要拖拽了，我们要练习打字，Tab键是缩进。我要注意要用英文输入法。像下面：向前走，moveForward每次0.01格,在1/20秒内,永远重复执行。演员就会一直向前走。

```lua
registerClickEvent(function()
    while(true) do
        moveForward(0.01)
    end
end)
```

那么为了能够单独执行代码方块查看效果，我们先Ctrl加左键，把第一个代码方块移走，再把第二个代码方块移过来，我们看一下单独执行的效果。 右键单击代码方块，点击运行。我们点击一下演员，可以看到演员一直向前走是停不下来的，因为`while true`是永远重复执行。

现在我们将两个代码方块重新连接在一起。两个代码方块都控制的是电影方块中的演员。这时我们可以通过右键单击任何一个代码方块来切换它们两者之中的代码。还有一种切换方式，我们可以给每一个代码方块取一个名字，比如其中一个代码方块会让演员一直向前走，我们给它取名为move，此时我们将鼠标移至旁边的省略号，可以看到它的名字是move。 另外一个代码方块是`未命名`，我们点击切换过去，他会让演员一直旋转，我们给它取名为turn。这时我们也可以在通过点击名字右侧的`...`按钮方便的切换两个代码方块。

 
```@BigFile
bigFile:
  src: 'https://api.keepwork.com/storage/v0/siteFiles/2753/raw#image.png'
  ext: png
  filename: image.png
  size: '22594'
  unit: px
  width: '400'
  alignment: left

```

这个时候我们无论在哪一个代码方块的编辑界面上点击运行，都会同时运行和它相连的所有代码方块中的代码。下面我们点击运行，那么演员会同时执行两个代码方块中的代码，也就是点击演员后，他会边走边旋转。我们点击运行就可以看到效果了。

我们点击暂停，回到第一个代码方块，我们之前还给演员做了一段招手的动画，我们也把它加入进来。 我们将外观项下的`循环播放`，拖入任意一个代码方块，比如拖到第一个里面，将它放到while的外面，我们将它改成从0秒开始到第1000毫秒循环播放，也就是在点击演员时，它会先循环播放动画, 再不停的旋转。
```lua
turnTo(180)
say("点击我!")
registerClickEvent(function()
    playLoop(0, 1000);
    while(true) do
        turn(1)
    end
end)
```
playLoop和play一样，执行之后立即返回，继续执行后面的代码。那么运行后最终的效果就是点击演员后，它会循环招手动作，同时不停地旋转。在另外一个代码方块中，演员被点击后会不停的向前走。那么我们点击一下运行，看一下最后的效果。 点击演员，可以看到演员一边做招手的动作, 一边旋转, 一边往前走，三者是同时执行的。

下面我们来看如何在场景中同时激活两个代码方块。我们到电影项下选择拉杆，拉杆可以放在两个代码方块旁边的任何一个位置，我们打开其中任意一个拉杆，可以看到两个代码方块同时亮起，表示两个代码方块都被执行了。

 
```@BigFile
bigFile:
  src: 'https://api.keepwork.com/storage/v0/siteFiles/2754/raw#image.png'
  ext: png
  filename: image.png
  size: '1042602'
  unit: px
  width: 450
  alignment: left

```

点击演员可以看到同时执行的效果。关闭拉杆，打开另外一个拉杆，两个代码方块仍然是同时亮起，被执行的，效果也是一样的。我们还可以用电影项下的导线连接另外一组代码方块。 这时我们打开这个拉杆，可以看到两组代码方块也是同时执行的。
 
```@BigFile
bigFile:
  src: 'https://api.keepwork.com/storage/v0/siteFiles/2755/raw#image.png'
  ext: png
  filename: image.png
  size: '1024029'
  unit: px
  width: '450'
  alignment: left

```

在调试程序时，我们会经常需要先调试一组代码方块，再调试另外一组，这在编程开发中叫做`单元测试`。像Paracraft这款软件，有一百多万行NPL代码，由6000多个像代码方块这样的文件组成。我们在写这样的大型程序时，经常需要让每一组文件可以独立的运行和被测试。

最后我再补充一下，到今天为止，我们还没有告诉大家计算机语言的语法，因为它并不重要，重要的是大多数计算机语言都和英语很接近。 越优秀的程序员，写的代码越接近英文。 

人类发明了上百种自然语言，中文，英文，等等，在过去几十年中，人类也发明了上百种计算机语言。我们刚刚使用的计算机语言叫做NPL，神经元并行计算机语言，是一款专门为人工智能，分布式计算以及3D仿真开发的编程语言。我们所使用的Paracraft动画软件，魔法哈奇，我们的网站都是用NPL语言编写的。 所以学会它，你可以写出像魔法哈奇这样复杂的大型3D软件或像keepwork.com这样的复杂网站服务器。青少年精通一门通用编程语言是很必要的，因为只要精通任意一门编程语言，其它语言基本都可以在几小时内学会。NPL是最佳的选择之一，因为它易于学习，功能强大，配合了Paracraft动画工具，并且语法和C/C++接近。 

代码方块中的所有命令可分为两大类：
- 一类是用于做相似匹配的。比如比较状态或响应事件。
- 一类是用于播放动画的。比如移动人物或播放电影方块中角色从某个时间点的动画

其实如果人脑也是一个计算机的，我们的思维也大概分成上面两大类。比如当我们看到一个和苹果很像的东西时，我们会做相似匹配，并从记忆的电影库中播放一段舌头或声音的动画，在脑海中产生了苹果的发音。


### 动手练习
去Paracraft里尝试一下用多个代码方块来控制电影方块。